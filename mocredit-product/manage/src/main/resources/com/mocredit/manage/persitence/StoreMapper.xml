<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.mocredit.manage.persitence.StoreMapper" >
  <resultMap id="BaseResultMap" type="com.mocredit.manage.model.Store" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Nov 02 15:47:55 CST 2015.
    -->
    <id column="id" property="id" jdbcType="VARCHAR" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="code" property="code" jdbcType="VARCHAR" />
    <result column="merchant_id" property="merchantId" jdbcType="VARCHAR" />
    <result column="province" property="province" jdbcType="INTEGER" />
    <result column="city" property="city" jdbcType="INTEGER" />
    <result column="area" property="area" jdbcType="INTEGER" />
    <result column="address" property="address" jdbcType="VARCHAR" />
    <result column="longitude" property="longitude" jdbcType="DOUBLE" />
    <result column="latitude" property="latitude" jdbcType="DOUBLE" />
    <result column="status" property="status" jdbcType="TINYINT" />
    <result column="mobile" property="mobile" jdbcType="VARCHAR" />
    <result column="phone" property="phone" jdbcType="VARCHAR" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="linkman" property="linkman" jdbcType="VARCHAR" />
    <result column="provinceName" property="provinceName" jdbcType="VARCHAR" />
    <result column="cityName" property="cityName" jdbcType="VARCHAR" />
    <result column="areaName" property="areaName" jdbcType="VARCHAR" />
    <result column="merchantName" property="merchantName" jdbcType="VARCHAR" />
    <result column="business_status" property="businessStatus" jdbcType="INTEGER" />
    <result column="mail_address" property="mailAddress" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Nov 02 15:47:55 CST 2015.
    -->
    id, name, code, merchant_id, province, city, area, address, longitude, latitude, 
    status, mobile, phone,create_time,linkman,business_status,mail_address
  </sql>
  <select id="selectOne" resultMap="BaseResultMap" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Nov 02 15:47:55 CST 2015.
    -->
    select 
    <include refid="Base_Column_List" />
    from t_store
    where id = #{id,jdbcType=VARCHAR} and status!=2
  </select>
    <select id="selectAllForPage" resultMap="BaseResultMap" parameterType="java.util.Map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Nov 02 15:47:55 CST 2015.
    -->
    select 
    <include refid="Base_Column_List" />
    ,(select count(1) from t_terminal where store_id=s.id) as terminalCount
    from t_store s
    <where>
    status!=2
    <if test="merchantId !=null and merchantId!=''">
    	and s.merchant_id=#{merchantId}
    </if>
    <if test="time1 != null and  time1!='' ">
    	and create_time &gt;=#{time1,jdbcType=TIMESTAMP}
    </if>
    <if test="time2 != null and  time2!=''  ">
    	and create_time &lt;=#{time2,jdbcType=TIMESTAMP}
    </if>
    <if test="snCode != null and  snCode !=''  ">
    	and s.id in (
    		select store_id from t_terminal 
    		where sn_code like concat('%',#{snCode,jdbcType=VARCHAR},'%') 
    	)
    </if>
    <if test="province != null and province !=0 ">
    	and province = #{province,jdbcType=INTEGER}
    </if>
    <if test="city != null and city !=0 ">
    	and city = #{city,jdbcType=INTEGER}
    </if>
    <if test="area != null and area !=0 ">
    	and area = #{area,jdbcType=INTEGER}
    </if>
    <if test="key !=null and key !=''">
    	and(s.name like #{key}
    		or s.code like #{key}
    		or s.linkman like #{key}
    		or s.phone like #{key}
    		or s.address like #{key}
    	)
    </if>
    </where>
    <choose>
    	<when test="sortorder==1">
    		order by s.create_time desc
    	</when>
    	<when test="sortorder==2">
    		order by s.create_time asc
    	</when>
    </choose>
  </select>
   <select id="checkStoreCode" resultMap="BaseResultMap" parameterType="java.util.Map" >
		select code
		from t_store
		<where>
		status!=2
		 and code=#{code}
		<if test="id!=null">
   			and id!=#{id}
   		</if>
		</where>
		limit 1
  </select>
  <update id="deleteById" parameterType="java.util.List">
  	update t_store set status=2
  	where
  	 id in
  	  <foreach collection="ids" index="index" item="id" open="(" separator="," close=")">
				#{id}
	</foreach>
  </update>
  <update id="deleteByMerchantId" parameterType="java.lang.String">
  	update t_store set status=2
  	where
  	 merchant_id=#{merchantId}
  </update>
  <insert id="insert" parameterType="com.mocredit.manage.model.Store" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Nov 02 15:47:55 CST 2015.
    -->
    insert into t_store (id, name, code, 
      merchant_id, province, city, 
      area, address, longitude, 
      latitude, status, mobile, 
      phone,create_time,linkman,business_status,mail_address)
    values (#{id,jdbcType=VARCHAR}, #{name,jdbcType=VARCHAR}, #{code,jdbcType=VARCHAR}, 
      #{merchantId,jdbcType=VARCHAR}, #{province,jdbcType=INTEGER}, #{city,jdbcType=INTEGER}, 
      #{area,jdbcType=INTEGER}, #{address,jdbcType=VARCHAR}, #{longitude,jdbcType=DOUBLE}, 
      #{latitude,jdbcType=DOUBLE}, #{status,jdbcType=TINYINT}, #{mobile,jdbcType=VARCHAR}, 
      #{phone,jdbcType=VARCHAR},#{createTime},#{linkman},#{businessStatus},#{mailAddress})
  </insert>
  <update id="update" parameterType="com.mocredit.manage.model.Store" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Nov 02 15:47:55 CST 2015.
    -->
    update t_store
    <set >
      <if test="name != null" >
        name = #{name,jdbcType=VARCHAR},
      </if>
      <if test="code != null" >
        code = #{code,jdbcType=VARCHAR},
      </if>
      <if test="merchantId != null" >
        merchant_id = #{merchantId,jdbcType=VARCHAR},
      </if>
      <if test="province != null" >
        province = #{province,jdbcType=INTEGER},
      </if>
      <if test="city != null" >
        city = #{city,jdbcType=INTEGER},
      </if>
      <if test="area != null" >
        area = #{area,jdbcType=INTEGER},
      </if>
      <if test="address != null" >
        address = #{address,jdbcType=VARCHAR},
      </if>
      <if test="longitude != null" >
        longitude = #{longitude,jdbcType=DOUBLE},
      </if>
      <if test="latitude != null" >
        latitude = #{latitude,jdbcType=DOUBLE},
      </if>
      <if test="status != null" >
        status = #{status,jdbcType=TINYINT},
      </if>
      <if test="mobile != null" >
        mobile = #{mobile,jdbcType=VARCHAR},
      </if>
      <if test="phone != null" >
        phone = #{phone,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null" >
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="linkman != null" >
        linkman = #{linkman,jdbcType=VARCHAR},
      </if>
      <if test="businessStatus != null" >
        business_status = #{businessStatus,jdbcType=INTEGER},
      </if>
      <if test="mailAddress != null" >
        mail_address = #{mailAddress,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=VARCHAR} and status!=2
  </update>
  <select id="selectStoreCountByMerchantId" resultType="Map" parameterType="java.lang.String" >
  	SELECT SUM(business_status1) AS businessStatus1, SUM(business_status2) AS businessStatus2, SUM(business_status3) AS businessStatus3, SUM(business_status4) AS businessStatus4 FROM ( SELECT CASE WHEN business_status = 1 THEN 1 ELSE 0 END AS business_status1, CASE WHEN business_status = 2 THEN 1 ELSE 0 END AS business_status2, CASE WHEN business_status = 3 THEN 1 ELSE 0 END AS business_status3, CASE WHEN business_status = 4 THEN 1 ELSE 0 END AS business_status4 FROM t_store where merchant_id=#{merchantId} and status!=2 ) a
  </select>
   <select id="selectAreaCountByMerchantId" resultType="int" parameterType="java.lang.String" >
  	SELECT count(1) FROM ( SELECT area FROM t_store where merchant_id=#{merchantId}  and status!=2 GROUP BY area ) a
  </select>
</mapper>